<html>
 
<head>
  <script src="https://code.responsivevoice.org/responsivevoice.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.11/lodash.min.js"></script>
</head>
 
<body>
  <div id="main">
    <button id="startBtn">Start</button>
 
    <button id="yesBtn">YES</button>
    <button id="noBtn">NO</button>
  </div>
 
  <script>
    var language = "UK English Male";
    var pytania = [{
        "pytanie": "what is love?",
        "odpowiedz": "nie"
      },
      {
        "pytanie": "what love is?",
        "odpowiedz": "tak"
      },
    ];
    var aktualnePytanie = null;
    var currentQuestionIndex = -1;
    var result = 0;
 
    function handleMotion(event) {
 
      var div = document.createElement("div");
      var acceleration = event.acceleration;
      div.innerHTML = "x : " + acceleration.x + "\n";
      div.innerHTML += "y: " + acceleration.y + "\n";
      div.innerHTML += "z: " + acceleration.z + "\n";
 
      if (acceleration.y > 10) {
        responsiveVoice.speak("tak", language);
        if (aktualnePytanie.odpowiedz == "tak") {
          var correctAnswerEvent = new Event("correctAnswer");
          window.dispatchEvent(correctAnswerEvent);
 
        } else {
          var incorrectAnswerEvent = new Event("incorrectAnswer");
          window.dispatchEvent(incorrectAnswerEvent);
        }
      }
      if (acceleration.x > 10) {
        responsiveVoice.speak("nie", language);
 
        if (aktualnePytanie.odpowiedz == "nie") {
          var correctAnswerEvent = new Event("correctAnswer");
          window.dispatchEvent(correctAnswerEvent);
 
        } else {
          var incorrectAnswerEvent = new Event("incorrectAnswer");
          window.dispatchEvent(incorrectAnswerEvent);
        }
      }
 
      document.getElementById("main").appendChild(div);
    }
    var deviceMovedThrottled = _.throttle(handleMotion, 800);
 
    function addMotionListener() {
      window.addEventListener("devicemotion", deviceMovedThrottled, true);
    };
 
    function removeMotionListener() {
      window.removeEventListener("devicemotion", deviceMovedThrottled, true);
    }
 
    window.addEventListener("correctAnswer", function () {
      removeMotionListener();
      responsiveVoice.speak("Good answer, you have a point!", language);
      result++;
      window.dispatchEvent(new Event("nextQuestion"));
    });
 
    window.addEventListener("incorrectAnswer", function () {
      removeMotionListener()
      responsiveVoice.speak("Wrong answer, sorry you dirty little shit, but you SUCK.", language);
      window.dispatchEvent(new Event("nextQuestion"));
    });
 
    window.addEventListener("endGame", function () {
      responsiveVoice.speak("Congratulations, you finished the quiz.", language);
      responsiveVoice.speak("You have: " + result.toString() + " points", language);
      responsiveVoice.speak("and now, go to hell with your poor result, you son of a bitch", language);
    });
 
    window.addEventListener("nextQuestion", function(){
      currentQuestionIndex++;
      if (currentQuestionIndex >= pytania.length) {
        window.dispatchEvent(new Event("endGame"));
        return;
      }
     
      if (currentQuestionIndex != 0) {
        responsiveVoice.speak("Next question....", language);
      }
     
      aktualnePytanie = pytania[currentQuestionIndex];
      responsiveVoice.speak(aktualnePytanie.pytanie, language);
 
      addMotionListener();
    });
 
    var yesBtn = document.getElementById("yesBtn")
    yesBtn.addEventListener("click", function(){
      console.log("yesBtn");
      window.dispatchEvent(new CustomEvent("devicemotion", { acceleration: { y: 15 }}))
    })
 
    var noBtn = document.getElementById("noBtn");
    noBtn.addEventListener("click", function(){
      console.log("noBtn");
      window.dispatchEvent(new CustomEvent("devicemotion", { acceleration: { x: 15 }}))
    });
 
    var startBtn = document.getElementById("startBtn");
    startBtn.addEventListener("click", function () {
      //run the QUIZ
      responsiveVoice.speak("Hello on the other side...", language);
      result = 0;
      currentQuestionIndex=-1;
      var correctAnswerEvent = new Event("nextQuestion"); //answer to question "-1" is correct, so we can move to question 0 (aka: start the game)
      responsiveVoice.speak("First question", language);
      window.dispatchEvent(correctAnswerEvent);
    });
  </script>
</body>
 
</html>